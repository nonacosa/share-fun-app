{{- /*
For a given taxonomy, renders a list of terms assigned to the page.
Supports internationalized display for tags.

@context {page} page The current page.
@context {string} taxonomy The taxonony.

@example: {{ partial "terms.html" (dict "taxonomy" "tags" "page" .) }}
*/}}

{{- $page := .page }}
{{- $taxonomy := .taxonomy }}

{{- if eq $taxonomy "tags" }}
  {{/* Handle tags with internationalization */}}
  {{- with $page.Params.tags }}
    <ul id="taxonomy" class="not-prose flex items-center space-x-4 flex-nowrap whitespace-nowrap overflow-x-auto">

      <li class="font-semibold my-4">{{ if eq $page.Site.Language.Lang "zh-cn" }}Tags:{{ else }}Tags:{{ end }}</li>
      {{- range . }}
        {{- $tagKey := . | replaceRE " " "-" | replaceRE "[^a-zA-Z0-9-]" "" }}
        {{- $localizedTag := i18n $tagKey }}
        {{- if not $localizedTag }}{{ $localizedTag = . }}{{ end }}
        {{- $tagTerm := $page.Site.GetPage (printf "/tags/%s" (. | urlize)) }}
        {{- $tagURL := "" }}
        {{- if $tagTerm }}
          {{- $tagURL = $tagTerm.RelPermalink }}
        {{- else }}
          {{/* Build language-appropriate tag URL */}}
          {{- if eq $page.Site.Language.Lang "zh-cn" }}
            {{- $tagURL = printf "/tags/%s/" (. | urlize) }}
          {{- else }}
            {{- $tagURL = printf "/%s/tags/%s/" $page.Site.Language.Lang (. | urlize) }}
          {{- end }}
        {{- end }}
        <li><a class="py-2 px-6 border rounded-full hover:bg-zinc-100 active:bg-zinc-300" href="{{ $tagURL }}">{{ $localizedTag }}</a></li>
      {{- end }}
    </ul>
  {{- end }}
{{- else }}
  {{/* Handle other taxonomies normally */}}
  {{- with $page.GetTerms $taxonomy }}
    {{- $label := (index . 0).Parent.LinkTitle }}

      <ul id="taxonomy" class="not-prose flex items-center space-x-4 flex-nowrap whitespace-nowrap overflow-x-auto">

        <li class="font-semibold my-4">{{ $label }}:</li>
        {{- range . }}
          <li ><a class="py-2 px-6 border rounded-full hover:bg-zinc-100 active:bg-zinc-300" href="{{ .RelPermalink }}">{{ .LinkTitle }}</a></li>
        {{- end }}
      </ul>

  {{- end }}
{{- end }}
