{{- /*
For a given taxonomy, renders a list of terms assigned to the page.
Supports internationalized display for tags.

@context {page} page The current page.
@context {string} taxonomy The taxonony.

@example: {{ partial "terms.html" (dict "taxonomy" "tags" "page" .) }}
*/}}

{{- $page := .page }}
{{- $taxonomy := .taxonomy }}

{{- if eq $taxonomy "tags" }}
  {{/* Handle tags with internationalization */}}
  {{- with $page.Params.tags }}
    <ul id="taxonomy" class="not-prose flex items-center space-x-4 flex-nowrap whitespace-nowrap overflow-x-auto">

      <li class="font-semibold my-4">{{ if eq $page.Site.Language.Lang "zh-cn" }}Tags:{{ else }}Tags:{{ end }}</li>
      {{- range . }}
        {{- $tagKey := . | replaceRE " " "-" | replaceRE "[^a-zA-Z0-9-]" "" }}
        {{- $localizedTag := i18n $tagKey }}
        {{- if not $localizedTag }}{{ $localizedTag = . }}{{ end }}
        {{- $tagTerm := $page.Site.GetPage (printf "/tags/%s" (. | urlize)) }}
        {{- $tagURL := "" }}
        {{- if $tagTerm }}
          {{- $tagURL = $tagTerm.RelPermalink }}
        {{- else }}
          {{/* Build language-appropriate tag URL */}}
          {{- if eq $page.Site.Language.Lang "zh-cn" }}
            {{- $tagURL = printf "/tags/%s/" (. | urlize) }}
          {{- else }}
            {{- $tagURL = printf "/%s/tags/%s/" $page.Site.Language.Lang (. | urlize) }}
          {{- end }}
        {{- end }}
        <li>
          <a href="{{ $tagURL }}" class="inline-flex items-center gap-x-1.5 rounded-full px-2 py-1 text-xs font-medium text-gray-900 inset-ring inset-ring-gray-200 hover:bg-gray-50 transition-colors">
            {{- $colors := slice "red-500" "yellow-500" "green-500" "blue-500" "indigo-500" "purple-500" "pink-500" "orange-500" "teal-500" "cyan-500" }}
            {{- $randomIndex := mod (len (printf "%s%s" $tagURL $localizedTag)) (len $colors) }}
            {{- $randomColor := index $colors $randomIndex }}
            <svg viewBox="0 0 6 6" aria-hidden="true" class="size-1.5 fill-{{ $randomColor }}">
              <circle r="3" cx="3" cy="3" />
            </svg>
            {{ $localizedTag }}
          </a>
        </li>
      {{- end }}
    </ul>
  {{- end }}
{{- else }}
  {{/* Handle other taxonomies normally */}}
  {{- with $page.GetTerms $taxonomy }}
    {{- $label := (index . 0).Parent.LinkTitle }}

      <ul id="taxonomy" class="not-prose flex items-center space-x-4 flex-nowrap whitespace-nowrap overflow-x-auto">

        <li class="font-semibold my-4">{{ $label }}:</li>
        {{- range . }}
          <li>
            <a href="{{ .RelPermalink }}" class="inline-flex items-center gap-x-1.5 rounded-full px-2 py-1 text-xs font-medium text-gray-900 inset-ring inset-ring-gray-200 hover:bg-gray-50 transition-colors">
              {{- $colors := slice "red-500" "yellow-500" "green-500" "blue-500" "indigo-500" "purple-500" "pink-500" "orange-500" "teal-500" "cyan-500" }}
              {{- $randomIndex := mod (len (printf "%s%s" .RelPermalink .LinkTitle)) (len $colors) }}
              {{- $randomColor := index $colors $randomIndex }}
              <svg viewBox="0 0 6 6" aria-hidden="true" class="size-1.5 fill-{{ $randomColor }}">
                <circle r="3" cx="3" cy="3" />
              </svg>
              {{ .LinkTitle }}
            </a>
          </li>
        {{- end }}
      </ul>

  {{- end }}
{{- end }}
